**FOOD**

1. 단순 리스트 출력의 경우
 - @RequestMapping("/foodlist.fn")
 - model로 foodlist 생성(sql 구문 필요)
 - return 주소

2. 페이징 추가
 - model + @RequestParam(value="pstartno", defaultValue = "1") int pstartno 필요
 - int 총 개수 카운팅 필요(sql)
 - new 페이징 dto 가져오기
 - model :  푸드리스트, 페이징 필요

3. 글쓰기 기능
 1) get - 글쓰기에 필요한 브랜드리스트, 영양리스트 model로 가져오기 
	
 2) post   
     - FoodDto fdto
	 - @RequestParam(required = false) List<String> nutrientid,  <-Integer 했더니 오류남 
	 - @RequestParam(required = false) List<String> amount,
	 - RedirectAttributes rttr

     - result1 사료 업로드(1) 
     - result2 영양 업로드(n)
     - 영양 업로드의 경우 여러 개를 업로드하기 때문에 반복문 이용.
     - if(amount.get(i) == null || amount.get(i).trim().equals("")) continue;  <- null이거나 빈 문자열인지 확인
     - if(nutrientid.get(i) == null || nutrientid.get(i).trim().equals("")) continue;  <- null이거나 빈 문자열인지 확인
     - NutriDto 초기화해서 값 집어넣기(사실 서비스단에서 처리해도 됨) 
     - if문 안에서 분기에 따라 rttr로 팝업 메시지 띄우기


4. 디테일 페이지
 - int foodid, model로 가져오기.	

5. 수정 get
 - 가져올 값이 좀 많음.. 빡세네
	
	@RequestMapping("/foodedit.fn")
	public String edit_get(int foodid, Model model) { //수정폼
		model.addAttribute("fdto", service.foodselect(foodid));
	    model.addAttribute("brandlist", service.brandSelectAll());
	    model.addAttribute("nutrientlist", service.nutrientSelectName());
	    model.addAttribute("nutriList", service.nutriselectWithInfo(foodid));

		return "foodboard/foodedit";
	}
	
	@RequestMapping(value="/foodedit.fn", method=RequestMethod.POST)
	public String edit_post(			//수정 - 입력 참고
	        FoodDto fdto,
	        @RequestParam(required = false) List<Integer> nutrientid,
	        @RequestParam(required = false) List<String> amount,
	        RedirectAttributes rttr) {

	    // 푸드 먼저
	    int result1 = service.foodupdate(fdto);

	    // 기존 영양소 전체 삭제** - 골라서 수정하기 빡셈 걍 해당 사료 영양소 다 날리고 새로 넣기로...
	    service.nutrideleteAll(fdto.getFoodid());

	    // 새 영양소 입력
	    if(nutrientid != null && amount != null){
	        for(int i=0; i<nutrientid.size(); i++){
	            if(amount.get(i) == null || amount.get(i).trim().equals("")) continue;
	            NutriDto ndto = new NutriDto();
	            ndto.setFoodid(fdto.getFoodid());
	            ndto.setNutrientid(nutrientid.get(i));
	            ndto.setAmount(Double.parseDouble(amount.get(i).trim()));

	            service.nutriinsert(ndto);
	        }
	    }

	    if(result1 > 0){
	        rttr.addFlashAttribute("success", "사료 수정 성공");
	        return "redirect:/fooddetail.fn?foodid=" + fdto.getFoodid();
	    } else {
	        rttr.addFlashAttribute("success", "사료 수정 실패");
	        return "redirect:/foodedit.fn?foodid=" + fdto.getFoodid();
	    }

	}
	
	@RequestMapping("/fooddelete.fn")
	public String delete(@RequestParam int foodid,  RedirectAttributes rttr) {//삭제폼
							//dto 쓰기는 과함 id만 있으면 됨
		 
		 int result1 = service.nutrideleteAll(foodid);
		 int result2 = service.fooddelete(foodid);
		 
			if(result1>0 && result2>0) {
				String result="삭제 성공";
				rttr.addFlashAttribute("success", result);
				return "redirect:/foodlist.fn";
			} else {
				String result="삭제 실패";
				rttr.addFlashAttribute("success", result);
				return "redirect:/fooddetail.fn?foodid=" + foodid;
			}
	}
	
	
	
	
//	@RequestMapping(value="/fooddelete.fn", method=RequestMethod.POST) 
//	public String delete_post(FoodDto fdto,  RedirectAttributes rttr) {//삭제
//		 int foodid=fdto.getFoodid();
//		 
//		 int result1 = service.nutrideleteAll(foodid);
//		 int result2 = service.fooddelete(foodid);
//		 
//			if(result1>0 && result2>0) {
//				String result="삭제 성공";
//				rttr.addFlashAttribute("success", result);
//				return "redirect:/foodlist";
//			} else {
//				String result="삭제 실패";
//				rttr.addFlashAttribute("success", result);
//				return "redirect:/fooddelete";
//			}
//
//	}
	
}


/*							
/foodlist.fn			/view/foodboard/foodlist.jsp   
/foodwrite.fn			/view/foodboard/foodwrite.jsp  (글쓰기폼)
/fooddetail.fn			/view/foodboard/fooddetail.jsp  (상세보기)
/foodedit.fn			/view/foodboard/foodedit.jsp  (수정폼)
/fooddelete.fn			/view/foodboard/fooddelete.jsp  (삭제폼)
							ㄴ/view/, .jsp는 서블릿에 자동으로 붙게 설정해둠
*/