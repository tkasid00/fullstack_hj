<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.thejoa703.dao.AppUserMapper">
	
	<resultMap type="AppUser" id="AppUserMap">
		<result property="appUserId"  column="APP_USER_ID"/>
		<result property="email"  column="EMAIL"/>
		<result property="password"  column="PASSWORD"/>
		<result property="mbtiTypeId"  column="MBTI_TYPE_ID"/>
		<result property="createdAt"  column="CREATED_AT"/>
		<result property="ufile"  column="UFILE"/>
		<result property="mobile"  column="MOBILE"/>
		<result property="nickname"  column="NICKNAME"/>
	</resultMap>

	<resultMap type="AuthDto" id="AuthMap">
		<result property="email"  column="EMAIL"/>
		<result property="auth"  column="AUTH"/>
	</resultMap>
	
	<resultMap type="AppUserAuthDto" id="AppUserAuthMap">
		<result property="email"  column="EMAIL"/>
		<result property="password"  column="PASSWORD"/>
		<collection property="authList" resultMap="authMap"/>
	</resultMap>
	
	
	<insert id="insert" parameterType="AppUser">
		insert into appuser(app_user_id, email, password, mbti_type_id, ufile, mobile, nickname) 
    		values(appuser_seq.nextval, #{email}, #{password}, #{mbtiTypeId}, #{ufile, jdbcType=VARCHAR}, #{mobile},  #{nickname})
	</insert>
	
	<update id="update" parameterType="AppUser">
		update appuser set mbti_type_id=#{mbtiTypeId}, ufile=#{ufile, jdbcType=VARCHAR}, mobile=#{mobile}, nickname=#{nickname}  
					where app_user_id=#{appUserId}
	</update>
	
	<delete id="delete" parameterType="AppUser">
		delete from appuser where app_user_id=#{appUserId}
	</delete>
	
	  <select  resultType="AppUserAuthDto"  id="readAuth"        parameterType="AppUser">
	    select     u.email, password, auth
	    from       appuser u    left join   authorities a   on  u.email = a.email  
	    where      u.email=#{email} 
	  </select>
	
	<select resultMap="AppUserMap" id="select" parameterType="AppUser">
		select * from appuser where email=#{email}	
	</select>
	
	<select resultMap="AppUserMap" id="selectPassword" parameterType="AppUser">
		select password from appuser where email=#{email}
	</select>



</mapper>