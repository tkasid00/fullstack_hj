##프로젝트 신규 테이블 정리 

**관리자 채팅방 - ADMIN_CHATROOM**

1. DESC  ADMIN_CHATROOM

| 컬럼명        | 데이터 타입         | 제약 조건                 | 설명 |
|--------------|-------------------|--------------------------|------|
| `ROOMID`     | `NUMBER`          | `PRIMARY KEY`            | 채팅방 고유 ID |
| `USERID`     | `NUMBER`          | `NOT NULL`               | 사용자 ID |
| `ADMINID`    | `NUMBER`          | `NOT NULL`               | 관리자 ID |
| `STATUS`     | `NUMBER(1)`       | `DEFAULT 1`              | 상담 진행 여부 |
| `CREATEDAT`  | `DATE`            | `DEFAULT SYSDATE`        | 상담일 |
| `CLOSEDAT`   | `DATE`            |                          | 종료일 |



이름        널?       유형        
--------- -------- --------- 
ROOMID    NOT NULL NUMBER           --기본키, 시퀀스 이용
USERID    NOT NULL NUMBER           --FK(USERS-USERID)/문의한 사용자 아이디
ADMINID   NOT NULL NUMBER           --FK(USERS-USERID)/상담하는 관리자 아이디
STATUS             NUMBER(1)        --1=상담중/2=상담종료           
CREATEDAT          DATE             --상담일/디폴트 SYSDATE
CLOSEDAT           DATE             --종료일


2. CREATE 외래키 없는 버전 

CREATE TABLE ADMIN_CHATROOM(
ROOMID NUMBER PRIMARY KEY,
USERID NUMBER NOT NULL,
ADMINID NUMBER NOT NULL,
STATUS NUMBER(1) DEFAULT 1,
CREATEDAT DATE DEFAULT SYSDATE,
CLOSEDAT DATE
);

CREATE SEQUENCE ADMIN_CHATROOM_SEQ
START WITH 1 INCREMENT BY 1
NOCACHE;

3. CRUD 구문 정리

--select
SELECT * FROM ADMIN_CHATROOM;
SELECT * FROM ADMIN_CHATROOM WHERE ROOMID=1;

--insert
INSERT INTO ADMIN_CHATROOM(ROOMID, USERID, STATUS)
    VALUES(ADMIN_CHATROOM_SEQ.NEXTVAL, 1, 1);

--update
UPDATE ADMIN_CHATROOM SET ADMINID=100 WHERE ROOMID=1;
UPDATE ADMIN_CHATROOM  SET STATUS=2, CLOSEDAT=SYSDATE WHERE ROOMID=1;

--delete





**메시지 보관 DB - CHATMESSAGE**

1. DESC CHATMESSAGE

| 컬럼명        | 데이터 타입         | 제약 조건                 | 설명 |
|--------------|-------------------|--------------------------|------|
| `MESSAGEID`  | `NUMBER`          | `PRIMARY KEY`            | 메시지 단위 고유 ID |
| `ROOMID`     | `NUMBER`          | `NOT NULL`               | 채팅방 ID |
| `SENDERID`   | `NUMBER`          | `NOT NULL`               | 발신인 ID |
| `MESSAGE`    | `VARCHAR2(2000)`  |                          | 메시지 내용 |
| `CREATEDAT`  | `DATE`            | `DEFAULT SYSDATE`        | 생성일 |
| `ISREAD`     | `NUMBER(1)`       | `DEFAULT 0`              | 읽음 여부 |




이름         널?       유형             
---------- -------- -------------- 
MESSAGEID  NOT NULL NUMBER              --메시지 고유번호/시퀀스 이용  
ROOMID     NOT NULL NUMBER              --FK(ADMIN_CHATROOM)
SENDERID   NOT NULL NUMBER              --발신인
MESSAGE             VARCHAR2(2000)      --메시지 내용 
CREATEDAT           DATE                --상담일/디폴트 SYSDATE
ISREAD              NUMBER(1)           --읽음 여부(0=안읽음/1=읽음)


2. CREATE 외래키 없는 버전 

CREATE TABLE CHATMESSAGE(
MESSAGEID NUMBER PRIMARY KEY,
ROOMID NUMBER NOT NULL,
SENDERID NUMBER NOT NULL,
MESSAGE VARCHAR2(2000),
CREATEDAT DATE DEFAULT SYSDATE,
ISREAD NUMBER(1) DEFAULT 0
);

CREATE SEQUENCE CHATMESSAGE_SEQ
START WITH 1 INCREMENT BY 1
NOCACHE;


3. CRUD 구문 정리

--SELECT(DB전체/채팅방전체/특정메시지/발신 주체별 메시지 모아보기)
SELECT * FROM CHATMESSAGE ORDER BY ROOMID, CREATEDAT;
SELECT * FROM CHATMESSAGE WHERE ROOMID=1 ORDER BY CREATEDAT;
SELECT * FROM CHATMESSAGE WHERE MESSAGEID=1;
SELECT * FROM CHATMESSAGE WHERE ROOMID=1 AND SENDERID=1 ORDER BY CREATEDAT;

--INSERT
INSERT INTO CHATMESSAGE(MESSAGEID, ROOMID, SENDERID,  MESSAGE, ISREAD)
    VALUES(CHATMESSAGE_SEQ.NEXTVAL, 1, 1, '안녕하세요', 0);
INSERT INTO CHATMESSAGE(MESSAGEID, ROOMID, SENDERID,  MESSAGE, ISREAD)
    VALUES(CHATMESSAGE_SEQ.NEXTVAL, 1, 100, '상담연결됐습니다', 0);

--UPDATE(읽음 처리-메시지 1개 단위/전체 읽음 처리)
UPDATE CHATMESSAGE SET ISREAD=1 WHERE MESSAGEID=1;
UPDATE CHATMESSAGE SET ISREAD=1 WHERE ROOMID=1 AND SENDERID=1 AND ISREAD=0;

--DELETE
DELETE FROM CHATMESSAGE WHERE MESSAGEID=1;



**챗봇 답변용 DB - FAQ**

1. DESC CHATMESSAGE

| 컬럼명        | 데이터 타입         | 제약 조건                 | 설명 |
|--------------|-------------------|--------------------------|------|
| `FAQID`      | `NUMBER`          | `PRIMARY KEY`            | 질문답변 고유 ID |
| `CATEGORY`   | `NUMBER`          | `NOT NULL`               | 분류 |
| `QUESTION`   | `NUMBER`          | `NOT NULL`               | 질문내용 |
| `ANSWER`     | `NUMBER(1)`       | `NOT NULL`               | 답변내용 |
| `KEYWORDS`   | `VARCHAR2(2000)`  |                          | 키워드 |
| `ISACTIVE`   | `NUMBER`          |                          | 사용여부 |
| `CREATEDAT`  | `DATE`            | `DEFAULT SYSDATE`        | 생성일 |
| `UPDATEDAT`  | `DATE`            |                          | 수정일 |


이름        널?       유형            
--------- -------- ------------- 
FAQID     NOT NULL NUMBER               --질문답변 고유번호(시퀀스 이용)
CATEGORY           VARCHAR2(50)         --분류(계정, 서비스, 이벤트, 기타)
QUESTION  NOT NULL VARCHAR2(500)        --질문
ANSWER    NOT NULL CLOB                 --답변내용
KEYWORDS           VARCHAR2(500)        --매칭키워드
ISACTIVE  NOT NULL NUMBER(1)            --사용여부(1=사용중/0=미사용)
CREATEDAT          DATE                 --생성일
UPDATEDAT          DATE                 --수정일



2. CREATE 외래키 없는 버전
CREATE TABLE FAQ (
  FAQID NUMBER PRIMARY KEY,
  CATEGORY VARCHAR2(50),
  QUESTION VARCHAR2(500) NOT NULL,
  ANSWER CLOB NOT NULL,
  KEYWORDS VARCHAR2(500),
  ISACTIVE NUMBER(1) DEFAULT 1 NOT NULL,
  CREATEDAT DATE DEFAULT SYSDATE,
  UPDATEDAT DATE
);

CREATE SEQUENCE FAQ_SEQ
START WITH 1 INCREMENT BY 1
NOCACHE;


3. CRUD 구문 정리
--SELECT(전체 조회/특정 답변/활성화-비활성화/카테고리별 활성화-비활성화 답변)
SELECT * FROM FAQ ORDER BY FAQID;
SELECT * FROM FAQ WHERE FAQID=1;
SELECT * FROM FAQ WHERE ISACTIVE=1 ORDER BY FAQID;
SELECT * FROM FAQ WHERE ISACTIVE=1 AND CATEGORY='계정' ORDER BY FAQID;

--INSERT(키워드 1NF 위반이지만 단순 참고용이라 이렇게 만들었습니다)
INSERT INTO FAQ(FAQID, CATEGORY, QUESTION, ANSWER, KEYWORDS, ISACTIVE)
VALUES (FAQ_SEQ.NEXTVAL, '계정', '펫 등록을 하고 싶어요', '로그인 후 마이페이지의 펫 등록 기능을 이용해 주세요', '펫, 등록, 추가', 1);

--UPDATE
UPDATE FAQ SET CATEGORY='기타', QUESTION='관리자에게 문의하고 싶어요', ANSWER='고객센터 채팅 기능을 이용해 주세요. 채팅 상담 이용 시간은 평일 09:00~18:00 입니다', KEYWORDS='관리자, 문의, 채팅, 고객센터', ISACTIVE='1', UPDATEDAT=SYSDATE;

--DELETE
DELETE FROM FAQ WHERE FAQID=1;


