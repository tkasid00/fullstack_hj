1. 로그 기록 확인 - git log
2. 엔터 - 전날 기록으로 거슬러올라감
3. git reset --hard HEAD~3 커밋 삭제, 백업 후 사용할 것 


##프로젝트 신규 테이블 정리

**관리자 채팅방 - ADMIN_CHATROOM**

1. DESC  ADMIN_CHATROOM

| 컬럼명        | 데이터 타입         | 제약 조건                 | 설명 |
|--------------|-------------------|--------------------------|------|
| `ROOMID`     | `NUMBER`          | `PRIMARY KEY`            | 채팅방 고유 ID |
| `USERID`     | `NUMBER`          | `NOT NULL`               | 사용자 ID |
| `ADMINID`    | `NUMBER`          |                          | 관리자 ID |
| `STATUS`     | `NUMBER(1)`       | `DEFAULT 1`              | 상담 진행 여부 |
| `CREATEDAT`  | `DATE`            | `DEFAULT SYSDATE`        | 상담일 |
| `CLOSEDAT`   | `DATE`            |                          | 종료일 |



이름        널?       유형        
--------- -------- --------- 
ROOMID    NOT NULL NUMBER           --기본키, 시퀀스 이용
USERID    NOT NULL NUMBER           --FK(USERS-USERID)/문의한 사용자 아이디
ADMINID            NUMBER           --FK(USERS-USERID)/상담하는 관리자 아이디/AI챗봇 우선 상담, 이후 필요 시 관리자 배정이기 때문에 NULL 허용 
STATUS             NUMBER(1)        --1=상담중/2=상담종료           
CREATEDAT          DATE             --상담일/디폴트 SYSDATE
CLOSEDAT           DATE             --종료일


2. CREATE 외래키 없는 버전 

CREATE TABLE ADMIN_CHATROOM(
ROOMID NUMBER PRIMARY KEY,
USERID NUMBER NOT NULL,
ADMINID NUMBER,
STATUS NUMBER(1) DEFAULT 1,
CREATEDAT DATE DEFAULT SYSDATE,
CLOSEDAT DATE
);

CREATE SEQUENCE ADMIN_CHATROOM_SEQ
START WITH 1 INCREMENT BY 1
NOCACHE;

3. CRUD 구문 정리

--select
SELECT * FROM ADMIN_CHATROOM;
SELECT * FROM ADMIN_CHATROOM WHERE ROOMID=1;

--insert
INSERT INTO ADMIN_CHATROOM(ROOMID, USERID, STATUS)
    VALUES(ADMIN_CHATROOM_SEQ.NEXTVAL, 1, 1);

--update
UPDATE ADMIN_CHATROOM SET ADMINDID=100 WHERE ROOMID=1;
UPDATE ADMIN_CHATROOM  SET STATUS=2, CLOSEDAT=SYSDATE WHERE ROOMID=1;

--delete
DELETE FROM ADMIN_CHATROOM WHERE ROOMID=1;





**메시지 보관 DB - CHATMESSAGE**

1. DESC CHATMESSAGE

| 컬럼명        | 데이터 타입         | 제약 조건                 | 설명 |
|--------------|-------------------|--------------------------|------|
| `MESSAGEID`  | `NUMBER`          | `PRIMARY KEY`            | 메시지 단위 고유 ID |
| `ROOMID`     | `NUMBER`          | `NOT NULL`               | 채팅방 ID |
| `SENDERID`   | `NUMBER`          | `NOT NULL`               | 발신인 ID |
| `SENDERTYPE` | `NUMBER(1)`       | `NOT NULL`               | 발신인 타입 |
| `MESSAGE`    | `VARCHAR2(2000)`  |                          | 메시지 내용 |
| `CREATEDAT`  | `DATE`            | `DEFAULT SYSDATE`        | 생성일 |
| `ISREAD`     | `NUMBER(1)`       | `DEFAULT 0`              | 읽음 여부 |




이름         널?       유형             
---------- -------- -------------- 
MESSAGEID  NOT NULL NUMBER              --메시지 고유번호/시퀀스 이용  
ROOMID     NOT NULL NUMBER              --FK(ADMIN_CHATROOM)
SENDERID   NOT NULL NUMBER              --발신인
SENDERTYPE NOT NULL NUMBER(1)           --발신인 구분(1=USER, 2=ADMIN, 3=AI)
MESSAGE             VARCHAR2(2000)      --메시지 내용 
CREATEDAT           DATE                --상담일/디폴트 SYSDATE
ISREAD              NUMBER(1)           --읽음 여부(0=안읽음/1=읽음)


2. CREATE 외래키 없는 버전 

CREATE TABLE CHATMESSAGE(
MESSAGEID NUMBER PRIMARY KEY,
ROOMID NUMBER NOT NULL,
SENDERID NUMBER NOT NULL,
SENDERTYPE NUMBER(1) NOT NULL,
MESSAGE VARCHAR2(2000),
CREATEDAT DATE DEFAULT SYSDATE,
ISREAD NUMBER(1) DEFAULT 0
);

CREATE SEQUENCE CHATMESSAGE_SEQ
START WITH 1 INCREMENT BY 1
NOCACHE;


3. CRUD 구문 정리

--SELECT(DB전체/채팅방전체/특정메시지/발신 주체별 관리자-사용자-AI가 보낸 메시지 모아보기)
SELECT * FROM CHATMESSAGE ORDER BY ROOMID, CREATEDAT;
SELECT * FROM CHATMESSAGE WHERE ROOMID=1 ORDER BY CREATEDAT;
SELECT * FROM CHATMESSAGE WHERE MESSAGEID=1;
SELECT * FROM CHATMESSAGE WHERE ROOMID=1 AND SENDERTYPE=1 ORDER BY CREATEDAT;

--INSERT
INSERT INTO CHATMESSAGE(MESSAGEID, ROOMID, SENDERID, SENDERTYPE, MESSAGE, ISREAD)
    VALUES(CHATMESSAGE_SEQ.NEXTVAL, 1, 1, 1, '안녕하세요', 0);
INSERT INTO CHATMESSAGE(MESSAGEID, ROOMID, SENDERID, SENDERTYPE, MESSAGE, ISREAD)
    VALUES(CHATMESSAGE_SEQ.NEXTVAL, 1, 100, 2, '상담연결됐습니다', 0);

--UPDATE(읽음 처리-메시지 1개 단위/전체 읽음 처리)
UPDATE CHATMESSAGE SET ISREAD=1 WHERE MESSAGEID=1;
UPDATE CHATMESSAGE SET ISREAD=1 WHERE ROOMID=1 AND SENDERTYPE=1 AND ISREAD=0;

--DELETE
DELETE FROM CHATMESSAGE WHERE MESSAGEID=1;








---
**나중에 필요 시 인덱스 생성(지금은 데이터 적어서XXX)

-- 채팅방별 메시지 조회
CREATE INDEX IDX_CHATMESSAGE_ROOM_TIME
ON CHATMESSAGE(ROOMID, CREATEDAT);

-- 발신 주체별 조회 (사용자/관리자/AI)
CREATE INDEX IDX_CHATMESSAGE_ROOM_SENDER_TIME
ON CHATMESSAGE(ROOMID, SENDERTYPE, CREATEDAT);

-- 읽음 처리
CREATE INDEX IDX_CHATMESSAGE_ISREAD
ON CHATMESSAGE(ROOMID, ISREAD);